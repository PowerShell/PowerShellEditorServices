language: cpp

git:
  depth: 1000

os:
  - linux
  - osx
sudo: required
dist: trusty
osx_image: xcode8.3

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      brew update;
      brew install openssl;
      mkdir -p /usr/local/lib;
      ln -s /usr/local/opt/openssl/lib/libcrypto.1.0.0.dylib /usr/local/lib/;
      ln -s /usr/local/opt/openssl/lib/libssl.1.0.0.dylib /usr/local/lib/;
    fi

install:
  - pushd scripts
  - ./download.sh
  - popd

script:
  - ulimit -n 4096
  - pwsh -Command {
      Get-Module PowerShellGet,PackageManagement | Remove-Module -Force -Verbose
      powershell -Command { Install-Module -Name PowershellGet -MinimumVersion 1.6 -force -confirm:$false -verbose }
      powershell -Command { Install-Module -Name PackageManagement -MinimumVersion 1.1.7.0 -Force -Confirm:$false -Verbose }
      Import-Module -Name PowerShellGet -MinimumVersion 1.6 -Force
      Import-Module -Name PackageManagement -MinimumVersion 1.1.7.0 -Force
      Install-PackageProvider -Name NuGet -Force | Out-Null
      Import-PackageProvider NuGet -Force | Out-Null
      Set-PSRepository -Name PSGallery -InstallationPolicy Trusted | Out-Null }
  - pwsh -File scripts/travis.ps1
